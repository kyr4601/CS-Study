# 라우팅 & 라우터

# 라우팅이란?

라우터(router)는 패킷(packet)의 목적지 주소를 확인하고, 목적지와 연결되는 인터페이스로 전송하는 역할을 한다. 

![Untitled](%E1%84%85%E1%85%A1%E1%84%8B%E1%85%AE%E1%84%90%E1%85%B5%E1%86%BC%20&%20%E1%84%85%E1%85%A1%E1%84%8B%E1%85%AE%E1%84%90%E1%85%A5%208598d717cb0e415c85bc0598dafd499f/Untitled.png)

말 그대로 Route(경로)를 선택하여 데이터가 전달될 수 있게 하는 것을 말하는데 이 경로를 최단거리, 최단시간에 전달될 수 있게 하는 것이 핵심적인 내용이다.

이와 같은 라우터의 기능을 라우팅(routing)이라고 합니다. 특히, IP 라우팅이란 패킷의 목적지 IP 주소를 참조하여 길을 찾아주는 것이다.

예를 들어 인천에는 여러 가지 경로가 존재하는데, 이 많은 경로 중에 하나를 선택하여 이동하는 것을 라우팅이라 한다. 

# 경로 선택

당연히도 라우터는 특정 데이터(패킷)의 목적지인 IP주소에 대한 정보를 갖고 있어야 스위칭이 가능하다. 

내가 부산에 사는데 서울이 어딘지도 모른다면 어디로 가야하는지 모를수밖에 없겠죠. 또, 길이 어떻게 생겨먹었는지도 알아야 할 것이고, 어디가 교통량이 많고 적은지, 어떤 톨 게이트를 거쳐야 하는지 등 알아야 할 정보가 많을겁니다.

라우팅 또한 최적의 경로를 선택하기 위해서는 이러한 정보들을 알고, 활용해야 합니다. 다음과 같은 요소들이 라우팅 경로 결정에 사용된다.

- 토폴로지
- 트래픽
- 링크 비용
- 메시지
- 라우팅 테이블

# **라우팅 프로토콜의 구분과 종류**

해당 목적지에 대한 정보를 알아야 하며 그 정보에 따라 패킷을 전달한다. 그래서 라우터들은 목적지에 대한 경로 정보를 이웃 라우터들과 공유하게 된다. 이 때 교환하는 것을 라우팅 프로토콜이라 한다. 

![Untitled](%E1%84%85%E1%85%A1%E1%84%8B%E1%85%AE%E1%84%90%E1%85%B5%E1%86%BC%20&%20%E1%84%85%E1%85%A1%E1%84%8B%E1%85%AE%E1%84%90%E1%85%A5%208598d717cb0e415c85bc0598dafd499f/Untitled%201.png)

라우터는 다른 라우터들로부터 라우팅 정보를 수신한 다음 그 중에서 최적의 경로를 선택하여 라우팅 테이블에 저장한다. 라우팅 테이블이란 목적지 네트워크 및 목적지 네트워크와 연결되는 인터페이스를 기록한 데이터베이스이다. 

## **정보 갱신 방법에 따른 구분**

라우팅 경로는 동적 경로(dynamic route)와 정적 겅로(static route)가 있다. 

| 구분 | 특징 |
| --- | --- |
| 정적 라우팅(Static Routing) | -  네트워크 관리자가 경로를 수동으로 직접 지정해 주는 방식. -  구성이 간단하고, 원하는 경로로 패킷을 보낼 수 있음. -  단일 경로에 적합하여 Stub Network 에 주로 적용. -  네트워크 구성 변화에 수동적임. -  관리 부담의 증가 및 경로 장애 발생시에 라우팅이 불가능함. |
| 동적 라우팅(Dynamic Routing) | -  장비가 자동으로 경로를 지정함. -  네트워크 변화를 인지하여 경로를 재구성할 수 있음. -  다중경로 네트워크에 적합함. - 라우팅 프로토콜(routing protocol)을 사용하여 동적으로 알아낸 경로 |

수동(고정) 경로 설정과 적응 경로 설정의 차이다.

 부산→서울 이동 경로를 생각했을때, 나는 무조건 정해진 길로만 가겠다! 와 차막히면 돌아가지 뭐,, 네비게이션이 안내 해 주는대로 가자~~ 정도의 차이라고 생각하시면 됩니다.

## **내/외부에 따른 구분**

**같은 네트워크 관리자가 관리하는 라우터들과 일정 규모의 집합을 AS(Autonomus System)** 이라 칭하는데, 이 규모에 따라 구분하는 방식

| 구분 | 특징 |
| --- | --- |
| IGP(Interior Gateway Protocol) | -  AS 내에서의 라우팅을 담당하는 프로토콜. |
| EGP(Exterior Gateway Protocol) | -  서로 다른 AS간 사용되는 프로토콜. |

마치 내부망, 외부망을 구분짓는 것과 느낌이 비슷한데, 이 구분이 망 구성이 중점이 되는것이 아니고 관리자나 관리 업체가 중점이 되는것이 차이점입니다. 

예를들어 KT가 관리하는 라우터들은 KT 입장에서는 IGP를 사용하고 SK가 관리하는 라우터들과는 EGP를 사용하게 되는겁니다.

## **테이블 관리 방법에 따른 구분**

| 구분 | 특징 |
| --- | --- |
| Distance VectorAlgorithm | -  최단 거리를 홉 수로 판단함. -  주기적으로 라우팅 테이블을 교환함. |
| Link StateAlgorithm | -  대역폭, 지연시간, 토폴로지를 참고하여 Cost를 책정함. -  라우터가 목적지까지 가는 경로를 모든 라우팅 테이블에 기록함. |
| Hybrid RoutingAlgorithm | -  거리벡터, 링크상태를 복합적으로 사용한 방식. -  Cisco 독점 프로토콜. |

부산→서울 이동을 생각했을 때, 나는 톨 게이트를 최대한 적게 지나가는 경로로 가겠다! 하는것이 거리벡터, 나는 교통량이 적은 곳으로 최대한 빨리 가보겠다! 하는것이 링크상태방식이다.

링크상태 방식에서 말하는 비용(Cost)은 금전적 의미가 아니고 **통신 속도**를 의미한다. 비용이 낮을수록 대역폭이 크다던가, 지연시간이 낮다던가 하는 것으로 빨리 전달할 수 있으면 비용이 낮다고 판단한다.

거리 벡터는 거리, 방향을 중점으로 최단거리 계산을 위해 Bellman-Ford 알고리즘을 사용합니다.

링크 상태는 라우터들이 정보를 주고받아 전체 토폴로지를 그리며 Dijkstra's 알고리즘을 사용합니다.

# 패킷

이렇게 라우팅 테이블이 만들어지면 해당 라우터는 특정 목적지 네트워크로 가는 패킷을 라우팅시킬 수 있다.

라우터가 패킷을 수신하고, 라우팅 테이블에 따라 정해진 목적지 인터페이스로 해당 패킷을 전송하게 된다.

## 1. 패킷의 처리

**1) 패킷의 발송**

이러한 IP패킷이 네트워크가 통과 시킬 수 있는 최대 바이트보다 클 경우에는 `단편화(Fragmentation)`시켜 보내게 되는데 그 단편화 정보도 IP패킷의 헤더에 저장하여 보내게 된다.

**2) 최종 목적지**

단편화된 패킷을 받은 목적지에서는 다면, 단편들을 모아서 **하나의 온전한 패킷을 조립한다.** 여기서 만약 하나의 온전한 패킷으로 조립이 불가능 하다면 모두 폐기시키고 이를 송신지에게 `CMP(Internet Control Message Protocol)메세지`를 보내게 된다.

## 2. 패킷의 전달

**1) 직접전달(Direct delivery)**

패킷의 송신지와 목적지가 동일한 네트워크에 연결되어 있을 때 직접전달하는 경우.

**2) 간접전달(Indirect delivery)**

패킷이 최종 목적지에 전달될 때까지 라우터에서 라우터로 전달되는 경우.

### 3. 라우팅 테이블

우리가 어떤 웹사이트에 접속을 한다고 했을 때 송신측의 네트워크 계층에서는 데이터 앞쪽에 정보를 담은 헤더(header)를 붙이게 된다.

**여기서 네트워크 계층에 데이터가 어디로 가야할지 경로를 설정할 수 있도록 `표 형태`로 구성되어 있는 것**을 `라우팅 테이블` 이라고 한다.

즉, 목적지로 갈때 최적의 경로가 표로 구성되어 있는 것을 라우팅 테이블이라고 하고 이를 참조하여 IP패킷을 보내게 되어있다.

이러한 라우팅 테이블은 처음 송신지에서 보낼때만 참조하는 것이 아니라 네트워크를 통해 이동하다가 **중간 장치들인 스위치나 라우터에서도 라우팅 테이블을 참조**하여 패킷을 보낸다.

**1) 라우팅 프로토콜**

라우팅 테이블을 만들어 주는 것이 바로 `라우팅 프로토콜`이다. 라우팅 프로토콜에서 라우팅 정보를 주고 받음으로써 이를 판단해 라우팅 테이블을 만들게 된다.

**2) 패킷의 전달 방법**

- **이웃노드명시(Next-hop method)**
    
    라우팅 테이블은 전체 경로상의 라우터를 명시하지 않고 `다음 라우터`만 명시한다.
    
    ![https://velog.velcdn.com/images%2Fanjaekk%2Fpost%2F960183aa-5e0c-48f8-b75f-3971f5913e39%2Fimage.png](https://velog.velcdn.com/images%2Fanjaekk%2Fpost%2F960183aa-5e0c-48f8-b75f-3971f5913e39%2Fimage.png)
    
    - A -> R1 -> R2 -> B 와 같이 전체 경로를 명시하는 것이 아니라 A는 R1만 명시!*(과도한 메모리사용으로 비효율적이기 때문!)*
    
- **네트워크 주소 명시(Network specific method)**
    
    IP주소는 크게 `네트워크ID`와 `호스트ID`로 구성되어 있는데 여기서 네트워크ID를 기반으로 호스트ID를 할당하기 때문에 만약 특정 기관이라면 그 안에 있는 모든 컴퓨터들은 네트워크ID가 모두 동일하게 된다. 
    
    이렇듯 목적지로 IP패킷을 전달할때 동일한 네트워크에 연결된 컴퓨터들을 하나하나 모두 명시하는 것이 아니라 **목적지 네트워크 주소만 명시하여 보내는 것**을 네트워크 주소 명시라고 한다.
    
    이처럼 간단하게 표기하게 되면 테이블 사이즈가 줄어들게 되고 이 효과로 빠른 검색과 메모리 효율성을 높일 수 있다.
    
    > 호스트 주소 명시(Host-specific method)
    > 
    > 
    > `특별한 목적`이 있는 경우라면 라우팅 테이블에 목적지 컴퓨터 주소를 직접 명시할수 있다! -> 관리자가 직접 입력해야함 (ex. 보안목적 등..)
    > 
    
- **디폴트 지정(Default method)**
    
    인터넷에 있는 모든 목적지를 지정할 수 없음으로 지정된 목적지 이외의 모든 지역을 지정하는 라우팅 엔트리를 `디폴트(Default)`라고 한다.(내가 지정한거 외에는 다 얘한테 보내!)
    
    > 보통 네트워크 주소가 0.0.0.0으로 표기 됨!
    > 

**3) 라우팅 프로토콜의 종류**

**(1) 유니캐스트 라우팅 프로토콜** = 보통의 그냥 라우팅 프로토콜

- `일대일 통신`을 말함
- 디지털 서명(Digital Signature)목적지가 하나이며 라우팅 정보를 교환하여 라우팅 테이블을 구축하는 형태

**(2) 멀티캐스트 라우팅 프로토콜**

- 송신지는 하나, 수신지는 여러개인 시스템으로 목적지가 동일한 그룹에 속한 여러 호스트가 될 수 있다.