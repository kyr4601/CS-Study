# 로드 밸런싱

# 로드밸런서란?

### **1. 로드밸런서(Load Balancer)**

![https://static.wixstatic.com/media/3aac70_069fdffae211437688d66863b767ccf9~mv2.png/v1/fill/w_755,h_329,al_c,lg_1,q_85,enc_auto/3aac70_069fdffae211437688d66863b767ccf9~mv2.png](https://static.wixstatic.com/media/3aac70_069fdffae211437688d66863b767ccf9~mv2.png/v1/fill/w_755,h_329,al_c,lg_1,q_85,enc_auto/3aac70_069fdffae211437688d66863b767ccf9~mv2.png)

로드밸런서(Load Balancer)는 **클라이언트와 서버 그룹 사이에 위치해 서버에 가해지는 트래픽을 여러 대의 서버에 고르게 분신(=밸런싱)하여 특정 서버의 부하(=로드)를 덜어준다.** 서버가 하나인데 많은 트래픽이 몰릴 경우 부하를 감당하지 못하고, 서버가 다운되어 서비스가 작동을 멈출 수 있다. 이런 문제를 해결하기 위해서 **Scale up(스케일업)과 Scale out(스케일아웃) 방식 중 한 가지**를 사용해 해결한다.

**그렇다면 로드밸런싱은 모든 경우에 항상 필요할까요?** 

로드밸런싱은 여러 대의 서버를 두고 서비스를 제공하는 분산 처리 시스템에서 필요한 기술이다. 

서비스의 제공 초기단계라면 적은 수의 클라이언트로 인해 서버 한 대로 요청에 응답하는 것이 가능하지만, 

사업의 규모가 확장되고, 클라이언트의 수가 늘어나게 되면 기본 서버만으로는 정상적인 서비스가 불가능하다. 

이처럼 증가하 트래픽에 대처할 수 있는 방법은 크게 2가지다. 

### **2. 스케일 업과 스케일 아웃**

![https://static.wixstatic.com/media/3aac70_7f4941e81df744fc82a36a952adabded~mv2.png/v1/fill/w_1062,h_286,al_c,lg_1,q_85,enc_auto/3aac70_7f4941e81df744fc82a36a952adabded~mv2.png](https://static.wixstatic.com/media/3aac70_7f4941e81df744fc82a36a952adabded~mv2.png/v1/fill/w_1062,h_286,al_c,lg_1,q_85,enc_auto/3aac70_7f4941e81df744fc82a36a952adabded~mv2.png)

**스케일 업(Scale Up)**은 **기존  서버 자체의 성능을 향상시키는 방법**으로 이는 CPU나 메모리를 업그레이드하는 것과 같은 작업을 포함한다. 반

**스케일 아웃(Scale Out)**은 존 서버와 동일하거나 낮은 성능의 서버를 두 대 이상 증설하여 운영하는 것과 같다. 즉 **트래픽이나 작업을 여러 대의 컴퓨터나 서버에 분산시켜 처리하는 방법이**다. 

각각의 방법은 장단점이 있어 어떤 방법이 더 적합한지 판단해야 한다.

| ​ | 스케일 업 | 스케일 아웃 |
| --- | --- | --- |
| 확장성 | 성능 확장에 한계 존재 | 지속적 확장이 가능 |
| 서버 비용 | 성능 증가에 따른 비용 증가 폭 큼
일반적으로 비용 부담이 큰 편 | 비교적 저렴한 서버를 사용하므로, 일반적으로 비용 부담이 적음 |
| 관리 편의성​ | 스케일 업에 따른 큰 변화 없음 | 서버 대수가 늘어날수록 관리 편의성 떨어짐 |
| 운영 비용 | 스케일 업에 따른 큰 변화 없음 | 서버 대수가 늘어날수록 운영 비용 증가 |
| 장애 영향 | 한 대의 서버에 부하가 집중되므로 장애 시 다운 타임 발생 | 부하가 여러 서버에 분산되어 처리됨으로 장애 시 전면 장애 가능성 적음 |

# 로드밸런싱 알고리즘

### **1. 정적 로드 밸런싱**

**1) 라운드 로빈 방식(Round Robin Method)**

클라이언트의 요청을 여러 대의 서버에 순차적으로 분배하는 방식이다. 클라이언트의 요청을 순서대로 분배하기 때문에 서버들이 동일 스펙을 가지고 있고, 서버와의 연결(세션)이 오래 지속되지 않는 경우 활용하기 적합하다.

- A, B, C의 서버를 가지고 있을 경우 A → B → C → A 순서대로 순회합니다.

**2) 가중치 기반 라운드 로빈 방식(Weighted Round Robin Method)**

각각의 서버마다 가중치(Weight)를 매기고 가중치가 높은 서버에 클라이언트의 요청을 먼저 배분합니다. 여러 서버가 같은 사양이 아니고, 특정 서버의 스펙이 더 좋은 경우 해당 서버의 가중치를 높게 매겨 트래픽 처리량을 늘릴 수 있습니다.

- 서버 A의 가중치 = 8, 서버 B의 가중치 = 2, 서버 C의 가중치 = 3
    - → 서버 A에 8개, 서버 B에 2개, 서버 C에 3개의 Request를 할당합니다.

**3) IP 해시 방식(IP Hash Method)**

IP 해시 방식에서 로드밸런서는 클라이언트 IP 주소에 대해 해싱이라고 하는 수학적인 계산을 수행합니다. 클라이언트 IP 주소를 숫자로 변환한 다음 개별 서버에 매핑합니다. 사용자 IP를 해싱하여 부하를 분산하기 때문에 사용자가 항상 동일한 서버로 연결되는 것을 보장합니다.

### **2. 동적 로드 밸런싱**

**1) 최소 연결 방법(Least Connection Method)**

최소 연결 방법에서 로드 밸런서는 활성 연결이 가장 적은 서버를 확인하고 해당 서버로 트래픽을 전송합니다. 이 방법에서는 모든 연결에 모든 서버에 대해 동일한 처리 능력이 필요하다고 가정합니다. 서버에 분배된 트래픽들이 일정하지 않은 경우에 적합하다. 

**2) 최소 응답 시간 방법(Least Response Time Method)**

서버의 현재 연결 상태와 응답 시간을 모두 고려하여, 가장 짧은 응답 시간을 보내는 서버로 트래픽을 할당합니다. 각 서버의 가용 가능한 리소스와 성능, 처리 중인 데이터양 등이 상이할 경우 적합합니다. 조건에 잘 들어맞는 서버가 있을 시 여유 있는 서버보다 먼저 할당됩니다. 로드 밸런서는 이 알고리즘을 사용하여 모든 사용자에게 더 빠른 서비스를 보장합니다.

**부하분산에는 L4로드밸런서와 L7 로드밸런서가 가장많이 활용된다.** 

그 이유는 L4 로드밸런서부터 포트정보를 바탕으로 로드를 분산하는 것이 가능하기 때문이다. 한 대의 서버에 각기 다른 포트 번호를 부여하여 다수의 서버 프로그램을 운영하는 경우라면 최소 L4 로드밸런서 이상을 사용해야 만 한다. 

# L4 로드밸런싱과 L7로드 밸런싱

![스크린샷 2024-02-03 오후 2.43.33.png](%E1%84%85%E1%85%A9%E1%84%83%E1%85%B3%20%E1%84%87%E1%85%A2%E1%86%AF%E1%84%85%E1%85%A5%E1%86%AB%E1%84%89%E1%85%B5%E1%86%BC%20565cca0f49c04de4b6a935d4596a9c50/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-02-03_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.43.33.png)

L4 로드밸런서는 네트워크 계층(IP.IPX)이나 트랜스포트 계층(TCP,UDP)의 정보를 바탕으로 로드를 분산한다. 

IP주소나 포트번호, MAC주소, 전송 프로토콜에 따라 트래픽을 나누는 것이 가능하다. 

반면 L7 로드밸런서의 경우 애플리케이션 계층 (HTTP, FTP, SMTP)에서 로드를 분산하기 때문에 HTTP헤더, 쿠키 등과 같은 사용자의 요청을 기준으로 특정 서버에 트래픽을 분산하는 것이 가능하다. 

쉽게 말해 패킷의 내용을 확인하고 그 내용에 따라 로드를 특정 서버에 분배하는 것이 가능한 것이다. 

위 그림과 같이 URL에 따라 부하를 분산시키거나, HTTP 헤더의 쿠키 값에 따라 부하를 분산하는 등 

클라이언트의 요청을 보다 세분화하여 서버에 전달 할 수 있다. 또한 L7 로드밸런서의 경우 특정한 패턴을 지닌 바이러스를 감지해 네트워크를 보호할 수 있으며 Dos/DDoS 과 같은 비정상적인 트래픽을 필터링할  수 있어 네트워크 보안 분야에서도 활용되고 있다. 

![스크린샷 2024-02-03 오후 2.44.27.png](%E1%84%85%E1%85%A9%E1%84%83%E1%85%B3%20%E1%84%87%E1%85%A2%E1%86%AF%E1%84%85%E1%85%A5%E1%86%AB%E1%84%89%E1%85%B5%E1%86%BC%20565cca0f49c04de4b6a935d4596a9c50/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-02-03_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.44.27.png)