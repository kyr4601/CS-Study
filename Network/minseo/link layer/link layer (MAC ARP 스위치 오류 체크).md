# link layer (MAC / ARP / 스위치 / 오류 체크)

- 데이터 링크 계층은 **직접 연결된** 서로 다른 2개의 네트워킹 장치 간의 데이터 전송을 담당한다.
- Network 장비 간에 **신호를 주고받는 규칙**을 정하는 계층
    - 대표적으로 Ethernet 프로토콜이 존재
- Network 기기 간에 **Data 전송 + 물리 주소를 결정**
- Data들을 Network 전송 방식에 맞게 **단위화(Framing)**해서, 해당 단위를 전송
    - 전송되는 Data를 프레임이라 한다
- Data Link layer에서 최종적으로 **이더넷 헤더/트레일러**가 붙는다.

링크계층에서 제공하는 서비스들을 살펴보자

## 주요 기능

**1) 프레이밍 (Framing)**

링크계층에서 일단 제공하는 가장중요한 서비스는 **프레이밍-프레임을** 만드는 것이다. 

**물리 계층으로 부터 받은 신호들을 조합**해서 **프래임단위**의 **정해진 크기의 Data Unit**으로 만들어서 처리 

프레임으로 만드는 작업을해서 데이터그램이 위쪽에서 내려와 캡슐화를 해서 프레임으로 만들게된다.

링크계층에서 사용하는 헤더와 트레일러,

트레일러는 앞뒤로 붙이는 메터데이터라고 생각해면 된다.

**2) 오류제어 (Error Control)** 

Farme 전송 시 발생하는 오류들을 복원하거나 재전송

**3) 흐름 제어 (Flow control)**

-송수신측 간에 Data를 주고 받을 때 **적당한 양의 Data를 송수신**할 수 있도록 Data의 흐름을 제어

**4) 접근 제어 (Access Control)**

매체 상에 기기가 여러 개 존재할 때 **데이터 전송 여부를 결정**

**5) 동기화 (Sysnchronization)**

- Frame 구분자 (특별한 비트 패턴) 

---

링크계층에는 2가지 종류가 있다. 

## 링크 계층의 종류

**1) Point-to-point link**

![https://blog.kakaocdn.net/dn/oMCMf/btrbgkha6U1/IOrS69awK96JJzVciDpsuK/img.png](https://blog.kakaocdn.net/dn/oMCMf/btrbgkha6U1/IOrS69awK96JJzVciDpsuK/img.png)

위 그림처럼 노드들 간에 dedicated 된 link를 사용하는 방식이다.

빠르고 보안성이 높다는 장점이 있지만, 패킷의 경로가 길어지거나, 네트워크 카드가 여러개 필요하는 등 효율성이 떨어진다는 단점이 있다.

이 경우, 신뢰성 있는 전달이나 flow control 등과 같은 Data link control 기능만 제공하면 된다.

**2) Broadcast link**

![https://blog.kakaocdn.net/dn/b2W1nl/btrbgnL9Kfg/ulzV7hjkth8r0ToKGd211K/img.png](https://blog.kakaocdn.net/dn/b2W1nl/btrbgnL9Kfg/ulzV7hjkth8r0ToKGd211K/img.png)

여러 노드들이 하나의 공유된 link를 사용하는 방식이다.

효율적이라는 장점이 있지만, 보안이 약하고, 여러 노드가 동시에 신호를 보낼 경우 변조될 가능성이 존재한다는 단점이 있다.

이 경우, 위 그림과 같이 Data link control 기능 뿐만 아니라, 여러 신호가 섞이는 것을 방지하기 위한 Media access control 기능도 필요하다.

### **Link layer 프로토콜은 OS 커널과 네트워크 카드에도 일부 구현되어 있다.**

![https://blog.kakaocdn.net/dn/bohPgZ/btrbgjWRcBl/KXSUpUVKJWFccDMjWDJNw1/img.png](https://blog.kakaocdn.net/dn/bohPgZ/btrbgjWRcBl/KXSUpUVKJWFccDMjWDJNw1/img.png)

위 그림처럼, 특정 application에서 트래픽을 보내고 싶을때, CPU를 통해 appilcation과 OS 커널에 구현된 프로토콜을 따라 내려오다, link layer를 거칠 때 네트워크 카드를 거치는 것을 확인할 수 있다.

이후 네트워크 카드의 physical transmission 인터페이스를 통해 실제 물리적인 신호가 전달되는 것이다.

# MAC 주소

![스크린샷 2024-02-03 오후 4.06.51.png](link%20layer%20(MAC%20ARP%20%E1%84%89%E1%85%B3%E1%84%8B%E1%85%B1%E1%84%8E%E1%85%B5%20%E1%84%8B%E1%85%A9%E1%84%85%E1%85%B2%20%E1%84%8E%E1%85%A6%E1%84%8F%E1%85%B3)%20e25ccc6dacd944eba88db685fd1ffefb/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-02-03_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_4.06.51.png)

- **랜 카드를 제조할 떄 정해지는 물리적 주소**
- **전 세계에서 유일한 번호**로 할당됨
- 총 **48비트**의 숫자로 구성됨
    - 앞 24 비트: 랜 카드 제조사 번호
    - 뒤 24 비트 : 제조사가 랜 카드에 붙인 일련 번호
    
    네트워크 장비 혹은 컴퓨터는 모두 MAC주소를 갖는다. 그런데 왜 MAC 주소가 필요할까? 
    
    ![스크린샷 2024-02-03 오후 4.41.15.png](link%20layer%20(MAC%20ARP%20%E1%84%89%E1%85%B3%E1%84%8B%E1%85%B1%E1%84%8E%E1%85%B5%20%E1%84%8B%E1%85%A9%E1%84%85%E1%85%B2%20%E1%84%8E%E1%85%A6%E1%84%8F%E1%85%B3)%20e25ccc6dacd944eba88db685fd1ffefb/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-02-03_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_4.41.15.png)
    
    ![스크린샷 2024-02-03 오후 4.42.10.png](link%20layer%20(MAC%20ARP%20%E1%84%89%E1%85%B3%E1%84%8B%E1%85%B1%E1%84%8E%E1%85%B5%20%E1%84%8B%E1%85%A9%E1%84%85%E1%85%B2%20%E1%84%8E%E1%85%A6%E1%84%8F%E1%85%B3)%20e25ccc6dacd944eba88db685fd1ffefb/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-02-03_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_4.42.10.png)
    

# 스위치 (Switch)

![스크린샷 2024-02-03 오후 4.08.30.png](link%20layer%20(MAC%20ARP%20%E1%84%89%E1%85%B3%E1%84%8B%E1%85%B1%E1%84%8E%E1%85%B5%20%E1%84%8B%E1%85%A9%E1%84%85%E1%85%B2%20%E1%84%8E%E1%85%A6%E1%84%8F%E1%85%B3)%20e25ccc6dacd944eba88db685fd1ffefb/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-02-03_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_4.08.30.png)

- Lv2 (데이터 링크)에서 동작
- Layer 2 Switch/ Swtiching Hub라고 불린다
- 스위치 내부에는 **MAC 주소 테이블** 존재

### MAC 주소 테이블 (MAC Address Table)

스위치의 포트번호 + 포트에 연결된 컴퓨터의 MAC 주소가 등록되는 DB

- MAC 주소 학습을 통해서 MAC 주소 테이블에 해당 포트 + MAC 주소를 저장
- 초기 상태에는 아무것도 등록 x

### 스위치 기능

1. **MAC 주소학습 (Learning)**
    - 목적지 MAC 주소가 추가된 Frame 전송
    - Frame이 스위치를 지나칠 때, MAC 주소 테이블에 출발지 MAC 주소가 등록
    
2. **플러딩 (Flooding)**
    - 목적지 MAC 주소가 MAC 주소 테이블에 등록되지 않은 경우
        - 출발지를 제외한 포트에 연결된 모든 컴퓨터에 Frame이 전송
    
3. **포워딩 (Forwarding)**
    - 스위치가 목적지 MAC주소를 보유하고 있을 때, 그대로 목적지 포트로 Frame을 전송
    - 나머지 포트는 필터링 되어서 Frame 전송 x
    
4. **필터링 (Filterling)**
    - 스위치가 목적지 MAC주소를 보유하고 있어서 해당 주소가 아닌 포트로는 Frame 전송 x
    
5. **에이징 (Aging)**
    - 스위치는 MAC 주소를 학습해서 MAC 테이블에 저장
    - MAC 주소는 기본적으로 300초동안 MAC 테이블에 저장
    - 300초 내에 Frame이 들어오지 않으면 해당 MAC 주소는 지워진다.
    - 시간은 조정 가능