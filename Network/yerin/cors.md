# 📌 CORS


!https://beomy.github.io/assets/img/posts/browser/url.png

**Protocol + Host + Port** 총 3가지가 같으면 **동일 출처 (Same Origin)**

## 🔸SOP (Same Origin Policy)

**다른 출처의 리소스를 사용하는 것을 제한하는 보안 방식**

다른 출처의 리소스를 사용하는 것을 왜 제한하는걸까?

> 클라이언트가 인스타그램 사용 중 해커의 스크립트가 심어진 http://hacking.com URL을 눌러 페이지를 열었다. 해커의 페이지에는 클라이언트의 토큰을 사용해 개인정보를 탈취하는 스크립트가 심어져있었고 클라이언트의 개인정보는 그대로 해커에게 넘어갔다.
> 

인스타그램 서버가 토큰만으로 유저를 판단한다면 클라이언트와 해커의 요청을 구분하기 힘들 것이다. 하지만 출처를 확인한다면 클라이언트와 해커의 출처는 서로 다르기 때문에 요청의 의도를 파악하고 해커의 요청을 차단할 수 있다.

이처럼 요청의 출처가 다르다면 **SOP (동일 출처 정책, Same-Origin Policy)**에 위반이라고 한다.

하지만 외부 라이브러리도 사용해야 하는데 요청과 리소스를 매번 동일한 출처로만 받을 수는 없다. 이 때 필요한 것이 **CORS**이다.

## 🔸CORS (Cross-Origin Resource Sharing)

> 교차 출처 리소스 공유(Cross-Origin Resource Sharing, CORS)는 추가 HTTP 헤더를 사용하여, 한 출처에서 실행 중인 웹 애플리케이션이 다른 출처의 선택한 자원에 접근할 수 있는 권한을 부여하도록 브라우저에 알려주는 체제이다. - MDN
> 

 CORS는 Cross-Origin Resource Sharing, 즉 **교차(다른) 출처 리소스 공유**이다.

출처가 다른 자원들을 공유한다는 뜻으로, 한 출처에 있는 자원에서 다른 출처에 있는 자원에 접근하도록 하는 개념이다.

개발을 하다 보면 기능상 어쩔 수 없이 다른 출처 간의 상호작용을 해야 하는 케이스도 있으며, 또한 실무적으로 다른 회사의 서버 API를 이용해야 하는 상황도 존재한다.

따라서 위와 같은 예외 사항을 두기 위해 CORS 정책을 허용하는 리소스에 한해 다른 출처라도 받아들인다는 것이다.

“CORS 에러 메세지”는 사실 브라우저의 SOP 정책에 따라 다른 출처의 리소스를 차단하면서 발생된 에러이며, CORS는 다른 출처의 리소스를 얻기위한 해결 방안이었던 것이다.

요약하자면 **SOP 정책을 위반해도 CORS 정책에 따르면 다른 출처의 리소스라도 허용한다**는 뜻이다.


### 브라우저의 CORS 기본 동작

1. 클라이언트 HTTP 요청

기본적으로 웹은 HTTP 프로토콜을 이용하여 서버에 요청을 보내게 되는데,

이때 브라우저는 요청 헤더에 Origin 이라는 필드에 출처를 함께 담아 보내게 된다.

2. Server 응답

서버에서 요청에 대한 응답 시 응답 헤더에 Access-Control-Allow-Origin 정보를 담아 보낸다.

3. 비교

요청할 때 보낸 Origin 정보와 서버에서 보낸 `Access-Control-Allow-Origin` 정보를 비교해 서버에서 보내준 `Access-Control-Allow-Origin`을 차단할지 말지 클라이언트 단에서 정한다.

유효하지 않다면 해당 응답은 버린다.

## 🔸해결방법

- 응답 헤더에 Access-Control-Allow-Origin 설정

로컬에서 뿐만 아니라 서버에서부터 근본적인 해결을 하고 싶다면 Access-Control-Allow-Origin를 설정해주면 된다.

- 서버에서 외부 API 접근하기

CORS는 브라우저 보안 정책이므로 서버에서 서버로 요청 시 CORS 이슈가 발생하지 않는다.

- Proxy 서버

서버와 서버 간 요청은 CORS 이슈가 발생하지 않는다는 것을 이용한 방식이다.

클라이언트에서 다이렉트로 서버로 요청 시 CORS 이슈가 발생하므로 중간에 Proxy 서버를 두어 해당 이슈가 발생하지 않도록 하는 방법이다.